
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Meteo CalabriaÂ â€” DashboardÂ Pro</title>

<!-- GoogleÂ Fonts & FontAwesome -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Baloo+2:wght@600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

<style>
/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ROOT THEME â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
:root{
  /* Light */
  --bg:linear-gradient(135deg,#e0efff,#bee1ff 40%,#a5d4ff);
  --panel:rgba(255,255,255,.3);
  --blur:18px;
  --radius:18px;
  --accent:#0ea5e9;
  --accent-alt:#38bdf8;
  --text:#07223a;
  --marker-size:clamp(22px,5vw,48px);
  --text-dim:#32506e;
  --good:#16a34a;
  --bad:#dc2626;
}
@media(prefers-color-scheme:dark){
 :root{
  --bg:linear-gradient(135deg,#001219,#004065 40%,#006494);
  --panel:rgba(255,255,255,.08);
  --text:#ecf1f8;
  --text-dim:#96a3ba;
 }
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
 font-family:"Inter",sans-serif;
 background:var(--bg);
 color:var(--text);
 display:flex;
 flex-direction:column;
 align-items:center;
 gap:22px;
 padding:22px 12px;
}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” SEARCH BAR â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
#searchForm{display:flex;gap:.6rem;width:100%;max-width:820px}
#cityInput{
 flex:1;border:none;border-radius:var(--radius);
 background:var(--panel);backdrop-filter:blur(var(--blur));
 padding:.9rem 1.1rem;
 font-size:1rem;outline:none;color:var(--text);
}
#searchForm button{
 border:none;border-radius:var(--radius);
 background:linear-gradient(135deg,var(--accent),var(--accent-alt));
 color:#fff;font-weight:700;font-size:1rem;
 padding:.9rem 1.35rem;cursor:pointer
}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” WIDGET CORE â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
#widget{
 width:100%;max-width:820px;
 display:grid;grid-template-columns:1fr auto;
 grid-template-areas:"header header""map forecast""bottom bottom";
 gap:0;
 border-radius:22px;
 overflow:hidden;
 box-shadow:0 14px 40px rgba(0,0,0,.28);
 position:relative;
 isolation:isolate;
 background:var(--panel);backdrop-filter:blur(var(--blur));
}
@media(max-width:600px){
 #widget{grid-template-columns:1fr;
         grid-template-areas:"header""map""forecast""bottom"}
}
header{grid-area:header;padding:20px;font-family:"Baloo 2",cursive;text-shadow:0 2px 10px rgba(0,0,0,.3)}
header h1{font-size:clamp(28px,7vw,40px);font-weight:800}
header p{font-size:clamp(14px,3vw,18px);font-weight:600;opacity:.9}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” MAP â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
#mapArea{grid-area:map;position:relative;padding-bottom:70%;margin:0 16px;border-radius:10px;overflow:hidden}
#mapArea img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;pointer-events:none;opacity:.3}
.marker{
 position:absolute;left:0;top:0;transform:translate(-50%,-50%);
 font-size:var(--marker-size);cursor:var(--cursor,default);
 filter:drop-shadow(0 2px 4px rgba(0,0,0,.5));
 user-select:none;
}
.marker.editing{animation:pulse 1.2s infinite}
@keyframes pulse{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.15)}100%{transform:translate(-50%,-50%) scale(1) }}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” FORECAST TABLE â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
#forecastWrapper{grid-area:forecast;display:flex;overflow-x:auto;padding-bottom:4px;margin-right:16px}
#forecast{
 border-collapse:collapse;font-size:.9rem;min-width:260px;
 background:var(--panel);backdrop-filter:blur(10px);
 border-radius:12px;overflow:hidden;margin:auto
}
#forecast th,#forecast td{padding:6px 12px;white-space:nowrap}
#forecast th{background:rgba(255,255,255,.2);font-family:"Baloo 2",cursive}
#forecast tr:nth-child(even){background:rgba(255,255,255,.08)}
#forecast tr:hover{background:rgba(255,255,255,.14)}
#forecast td:nth-child(2),#forecast td:nth-child(3){font-weight:700;font-size:18px}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” BOTTOM BAR â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
#bottomBar{
 grid-area:bottom;display:flex;align-items:center;gap:10px;
 background:var(--panel);backdrop-filter:blur(8px);
 padding:10px 16px
}
#nav{flex:1;display:flex;gap:6px;overflow-x:auto}
#nav button{
 background:transparent;border:none;border-radius:8px;
 padding:6px 10px;font-weight:600;cursor:pointer;
 color:var(--text);transition:.2s
}
#nav button:hover{background:rgba(255,255,255,.3)}
#nav button.active{background:var(--accent);color:#fff}
.fab-btn{
 width:46px;height:46px;border:none;border-radius:50%;cursor:pointer;
 display:flex;align-items:center;justify-content:center;
 font-size:22px;box-shadow:0 6px 14px rgba(0,0,0,.3);
 transition:transform .2s
}
.fab-btn:hover{transform:scale(1.1)}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ADMIN PANEL â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
#adminModal{
 position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
 background:#0008;backdrop-filter:blur(4px);z-index:99;visibility:hidden;opacity:0;transition:.3s
}
#adminModal.open{visibility:visible;opacity:1}
#adminModal .box{
 background:var(--panel);backdrop-filter:blur(var(--blur));
 border-radius:var(--radius);padding:1.4rem;width:92%;max-width:420px
}
#adminModal h2{margin-bottom:.8rem}
#adminModal .list{max-height:50vh;overflow:auto;margin-bottom:1rem}
#adminModal .list div{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
#adminModal button{border:none;border-radius:8px;padding:.5rem .9rem;font-weight:700;cursor:pointer}
#adminModal .close{background:var(--bad);color:#fff}
#adminModal .save{background:var(--good);color:#fff;margin-left:auto}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” UTILITY â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Responsiveness tweaks */
@media(max-width:400px){
 #forecast td:nth-child(2),#forecast td:nth-child(3){font-size:16px}
}
</style>
</head>
<body>

<!-- SEARCH -->
<form id="searchForm">
 <label for="cityInput" class="sr-only">Cerca cittÃ </label>
 <input id="cityInput" placeholder="Scrivi una cittÃ  o usa ğŸ“â€¦" autocomplete="off" required>
 <button type="submit" aria-label="Cerca"><i class="fa-solid fa-search"></i></button>
</form>

<!-- WIDGET -->
<div id="widget">
 <header>
  <h1 id="hDay">GIORNOÂ 1</h1>
  <p id="hDate"></p>
 </header>

 <div id="mapArea">
  <img id="mapImg" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Map_of_region_of_Calabria%2C_Italy.svg/565px-Map_of_region_of_Calabria%2C_Italy.svg.png" alt="Mappa Calabria">
 </div>

 <div id="forecastWrapper">
  <table id="forecast"></table>
 </div>

 <div id="bottomBar">
  <button class="fab-btn" id="editBtn" title="Modifica mappa" aria-label="Modifica mappa"><i class="fa-solid fa-pen-to-square"></i></button>
  <nav id="nav" aria-label="Seleziona giorno previsioni"></nav>
  <button class="fab-btn" id="adminBtn" title="Pannello admin" aria-label="Pannello admin"><i class="fa-solid fa-gear"></i></button>
 </div>
</div>

<!-- ADMIN MODAL -->
<div id="adminModal">
 <div class="box">
  <h2>Editor Marker</h2>
  <div class="list" id="markerList"></div>
  <div style="display:flex;gap:.6rem;justify-content:flex-end">
    <button class="save" id="exportBtn">Esporta JSON</button>
    <button class="close" id="closeAdmin">Chiudi</button>
  </div>
 </div>
</div>

<footer style="font-size:.8rem;color:var(--text-dim);max-width:820px;text-align:center">Previsioni automatiche â€“ dati <a href="https://open-meteo.com" target="_blank">Openâ€‘Meteo</a> e rete privataÂ MLG.</footer>

<script>
/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” CONSTANTS â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
const MAP_BOUNDS={latMin:37.90,latMax:40.30,lonMin:15.60,lonMax:17.30};
const DEFAULT_MARKERS=[{city:"Cosenza",lat:39.299,lon:16.253},{city:"Catanzaro",lat:38.909,lon:16.587},{city:"Reggio Calabria",lat:38.114,lon:15.65},{city:"Crotone",lat:39.083,lon:17.125},{city:"Vibo Valentia",lat:38.673,lon:16.104}];

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” STATE â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
let markers=JSON.parse(localStorage.getItem("calabriaMarkers")||JSON.stringify(DEFAULT_MARKERS));
let DAYS=[],curDay=0,editMode=false;

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” UTILITIES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
const $=q=>document.querySelector(q);
function latLonToXY(lat,lon){
  const x=(lon-MAP_BOUNDS.lonMin)/(MAP_BOUNDS.lonMax-MAP_BOUNDS.lonMin)*100;
  const y=(1-(lat-MAP_BOUNDS.latMin)/(MAP_BOUNDS.latMax-MAP_BOUNDS.latMin))*100;
  return {x,y};
}
function wmo(code,isNight=false){
  const mapDay={0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…ï¸",3:"ğŸŒ¥ï¸",45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",51:"ğŸŒ¦ï¸",53:"ğŸŒ¦ï¸",55:"ğŸŒ¦ï¸",61:"ğŸŒ§ï¸",63:"ğŸŒ§ï¸",65:"ğŸŒ§ï¸",80:"ğŸŒ§ï¸",81:"ğŸŒ§ï¸",82:"ğŸŒ§ï¸",66:"ğŸŒ¨ï¸",67:"ğŸŒ¨ï¸",71:"ğŸŒ¨ï¸",73:"ğŸŒ¨ï¸",75:"ğŸŒ¨ï¸",77:"ğŸŒ¨ï¸",85:"ğŸŒ¨ï¸",86:"ğŸŒ¨ï¸",95:"â›ˆï¸",96:"â›ˆï¸",99:"â›ˆï¸"};
  const mapNight={0:"ğŸŒ™",1:"ğŸŒ™",2:"â›…ï¸",3:"â˜ï¸",45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",51:"ğŸŒ¦ï¸",53:"ğŸŒ¦ï¸",55:"ğŸŒ¦ï¸",61:"ğŸŒ§ï¸",63:"ğŸŒ§ï¸",65:"ğŸŒ§ï¸",80:"ğŸŒ§ï¸",81:"ğŸŒ§ï¸",82:"ğŸŒ§ï¸",66:"ğŸŒ¨ï¸",67:"ğŸŒ¨ï¸",71:"ğŸŒ¨ï¸",73:"ğŸŒ¨ï¸",75:"ğŸŒ¨ï¸",77:"ğŸŒ¨ï¸",85:"ğŸŒ¨ï¸",86:"ğŸŒ¨ï¸",95:"â›ˆï¸",96:"â›ˆï¸",99:"â›ˆï¸"};
  return (isNight?mapNight:mapDay)[code]||"â“";
}
function fetchForecast(lat,lon){
  const url=\`https://api.open-meteo.com/v1/forecast?latitude=\${lat}&longitude=\${lon}&timezone=auto&daily=temperature_2m_max,temperature_2m_min,weathercode,sunrise,sunset\`;
  return fetch(url).then(r=>r.json());
}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” NAV & RENDER â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
function buildNav(){
  const nav=$("#nav");nav.innerHTML="";
  DAYS.forEach((d,i)=>{
    const b=document.createElement("button");b.textContent=d.label;
    if(i===curDay)b.classList.add("active");
    b.addEventListener("click",()=>{curDay=i;updateNav();render()});
    nav.appendChild(b);
  });
}
function updateNav(){
  $("#nav").querySelectorAll("button").forEach((b,i)=>b.classList.toggle("active",i===curDay));
}
function render(){
  const d=DAYS[curDay];
  $("#hDay").textContent=d.label;
  const now=new Date();now.setDate(now.getDate()+d.offset);
  $("#hDate").textContent=now.toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"}).toUpperCase();

  /* markers */
  const area=$("#mapArea");area.querySelectorAll(".marker").forEach(m=>m.remove());
  d.points.forEach(p=>{
     const mk=document.createElement("div");
     mk.className="marker";if(editMode)mk.classList.add("editing");
     mk.style.left=p.x+"%";mk.style.top=p.y+"%";
     mk.textContent=p.icon;mk.title=\`\${p.city}: \${p.tmax}Â° / \${p.tmin}Â°\`;
     if(editMode){
       mk.style.setProperty("--cursor","grab");
       mk.setAttribute("draggable","true");
       mk.addEventListener("dragstart",ev=>ev.dataTransfer.setData("text/plain",p.city));
     }
     area.appendChild(mk);
  });

  /* forecast */
  const tbl=$("#forecast");tbl.innerHTML="<tr><th>CittÃ </th><th>â¬†ï¸</th><th>â¬‡ï¸</th></tr>";
  d.points.forEach(p=>{
    tbl.insertAdjacentHTML("beforeend",\`<tr><td>\${p.city}</td><td>\${p.tmax}Â°</td><td>\${p.tmin}Â°</td></tr>\`);
  });
}

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” LOAD INITIAL â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
async function loadData(){
  const promises=markers.map(m=>fetchForecast(m.lat,m.lon));
  const results=await Promise.all(promises);
  DAYS=[];
  const len=results[0].daily.time.length;
  for(let d=0;d<len;d++){
    const obj={label:"GIORNOÂ "+(d+1),offset:d,points:[]};
    markers.forEach((m,idx)=>{
      const fc=results[idx];
      const isNight=d===0 && (new Date().getHours() <6 || new Date().getHours() >20);
      const {x,y}=latLonToXY(m.lat,m.lon);
      obj.points.push({
        city:m.city,
        x,y,
        icon:wmo(fc.daily.weathercode[d],isNight),
        tmax:Math.round(fc.daily.temperature_2m_max[d]),
        tmin:Math.round(fc.daily.temperature_2m_min[d])
      });
    });
    DAYS.push(obj);
  }
  buildNav();render();
}
loadData();

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” EDIT MODE â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
$("#editBtn").addEventListener("click",()=>{
  editMode=!editMode;
  $("#editBtn i").className=editMode?"fa-solid fa-eye":"fa-solid fa-pen-to-square";
  render();
});

/*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ADMIN PANEL â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*/
$("#adminBtn").addEventListener("click",()=>openAdmin());
$("#closeAdmin").addEventListener("click",()=>closeAdmin());
$("#exportBtn").addEventListener("click",()=>{
  navigator.clipboard.writeText(JSON.stringify(markers,null,2)).then(()=>{
    alert("JSON copiato negli appunti!");
  });
});
function openAdmin(){
  const list=$("#markerList");list.innerHTML="";
  markers.forEach((m,i)=>{
     const row=document.createElement("div");
     row.innerHTML=\`<span>\${m.city}</span><button data-i="\${i}" class="fa-solid fa-trash"></button>\`;
     row.querySelector("button").addEventListener("click",e=>{
        markers.splice(i,1);saveMarkers();openAdmin();
     });
     list.appendChild(row);
  });
  $("#adminModal").classList.add("open");
}
function closeAdmin(){$("#adminModal").classList.remove("open")}
function saveMarkers(){
  localStorage.setItem("calabriaMarkers",JSON.stringify(markers));
  loadData();
}

/* Allow adding marker by doubleâ€‘click on map in edit mode */
$("#mapArea").addEventListener("dblclick",e=>{
  if(!editMode)return;
  const rect=e.currentTarget.getBoundingClientRect();
  const x=(e.clientX-rect.left)/rect.width;
  const y=(e.clientY-rect.top)/rect.height;
  const lat=MAP_BOUNDS.latMax-(MAP_BOUNDS.latMax-MAP_BOUNDS.latMin)*y;
  const lon=MAP_BOUNDS.lonMin+(MAP_BOUNDS.lonMax-MAP_BOUNDS.lonMin)*x;
  const city=prompt("Nome cittÃ :");
  if(city){
    markers.push({city,lat:+lat.toFixed(3),lon:+lon.toFixed(3)});
    saveMarkers();
  }
});
</script>
</body>
</html>
